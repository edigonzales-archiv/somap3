<!doctype html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="http://ol3js.org/en/master/css/ol.css" type="text/css">
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
        <style>
            .map {
                height: 100%;
                width: 100%;
            }
            .ol-full-screen {
                right: auto;
                left: 0.5em;
                top: 5em;
            }
            
            .ol-full-screen .ol-has-tooltip:hover [role=tooltip],
            .ol-full-screen .ol-has-tooltip:focus [role=tooltip] {
                right: auto;
                left: 2.2em;
                border-radius: 0 4px 4px 0;
            }   

            .bg-layer-select {
                right: 0.5em;
                top: 0.5em;
                position: absolute;
            } 
        </style>
        
        <script src="http://cdnjs.cloudflare.com/ajax/libs/proj4js/1.1.0/proj4js-compressed.js" type="text/javascript"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/proj4js/1.1.0/defs/EPSG21781.js" type="text/javascript"></script>
        <script src="http://ol3js.org/en/master/build/ol.js" type="text/javascript"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        
        <title>OpenLayers 3 example</title>
    </head>
    <body style="margin:0px;">
<!--        <h2>My Map</h2>-->

        <div id="map" class="map">  
        </div>  
        

        <div class="bg-layer-select"> 
                <select id="layer-select"></select>
        </div>

              
<!--
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span12">
                    <div id="map" class="map">
                      
                       

            
                </div>
          </div>
-->
        
                
                      
            
            
        <script type="text/javascript">
            
            var bgLayerNames = [];
            var i, ii;
            
            var projection = ol.proj.configureProj4jsProjection({
                code: 'EPSG:21781',
                extent: [420000, 30000, 900000, 350000]
            });

            var projectionExtent = projection.getExtent();
            var zoomLevels = 29;
            var resolutions = [4000,3750,3500,3250,3000,2750,2500,2250,2000,1750,1500,1250,1000,750,650,500,250,100,50,20,10,5,2.5,2,1.5,1,0.5,0.25,0.1];
            var matrixIds = new Array(zoomLevels);
            
            for (var z = 0; z < zoomLevels; ++z) {
                matrixIds[z] = z;
            }
                        
            var layerColorMap = new ol.layer.Group({
                layerName: "Karte farbig",
                layerId: "karte_farbig",
                baselayer: true,
                visible: false,
                layers: [
                    new ol.layer.Tile({
                        minResolution: 2,
                        source: new ol.source.WMTS({
                            url: 'http://www.catais.org/mapcache/wmts',
                            layer: 'ch.so.agi.bpav10000-farbe',
                            matrixSet: 'CH1903',
                            format: 'image/png',
                            projection: projection,
                            tileGrid: new ol.tilegrid.WMTS({
                                origin: ol.extent.getTopLeft(projectionExtent),
                                resolutions: [4000,3750,3500,3250,3000,2750,2500,2250,2000,1750,1500,1250,1000,750,650,500,250,100,50,20,10,5,2.5,2],
                                matrixIds: matrixIds
                            }),
                        style: 'default'
                        })
                    }),
                    new ol.layer.Tile({
                        maxResolution: 2,
                        source: new ol.source.WMTS({
                            url: 'http://www.catais.org/mapcache/wmts',
                            layer: 'ch.so.agi.grundbuchplan-farbe',
                            matrixSet: 'CH1903',
                            format: 'image/png',
                            projection: projection,
                            tileGrid: new ol.tilegrid.WMTS({
                                origin: ol.extent.getTopLeft(projectionExtent),
                                resolutions: [4000,3750,3500,3250,3000,2750,2500,2250,2000,1750,1500,1250,1000,750,650,500,250,100,50,20,10,5,2.5,2,1.5,1,0.5,0.25,0.1],
                                matrixIds: matrixIds
                            }),
                        style: 'default'
                        })
                    })
                ]
            });
            
            var layerGrayMap = new ol.layer.Group({
                layerName: "Karte grau",
                layerId: "karte_grau",  
                baselayer: true,                
                visible: true,
                layers: [
                    new ol.layer.Tile({
                        minResolution: 2,
                        source: new ol.source.WMTS({
                            url: 'http://www.catais.org/mapcache/wmts',
                            layer: 'ch.so.agi.bpav10000-grau',
                            matrixSet: 'CH1903',
                            format: 'image/png',
                            projection: projection,
                            tileGrid: new ol.tilegrid.WMTS({
                                origin: ol.extent.getTopLeft(projectionExtent),
                                resolutions: [4000,3750,3500,3250,3000,2750,2500,2250,2000,1750,1500,1250,1000,750,650,500,250,100,50,20,10,5,2.5,2],
                                matrixIds: matrixIds
                            }),
                        style: 'default'
                        })
                    }),
                    new ol.layer.Tile({
                        maxResolution: 2,
                        source: new ol.source.WMTS({
                            url: 'http://www.catais.org/mapcache/wmts',
                            layer: 'ch.so.agi.grundbuchplan-grau',
                            matrixSet: 'CH1903',
                            format: 'image/png',
                            projection: projection,
                            tileGrid: new ol.tilegrid.WMTS({
                                origin: ol.extent.getTopLeft(projectionExtent),
                                resolutions: [4000,3750,3500,3250,3000,2750,2500,2250,2000,1750,1500,1250,1000,750,650,500,250,100,50,20,10,5,2.5,2,1.5,1,0.5,0.25,0.1],
                                matrixIds: matrixIds
                            }),
                        style: 'default'
                        })
                    })
                ]
            });

            var layerOrtho = new ol.layer.Tile({
                layerName: "Luftbild",
                layerId: "luftbild",
                baselayer: true,                
                visible: false,
                source: new ol.source.WMTS({
                    url: 'http://www.catais.org/mapcache/wmts',
                    layer: 'ch.so.agi.orthofoto',
                    matrixSet: 'CH1903',
                    format: 'image/jpeg',
                    projection: projection,
                    tileGrid: new ol.tilegrid.WMTS({
                        origin: ol.extent.getTopLeft(projectionExtent),
                        resolutions: resolutions,
                        matrixIds: matrixIds
                    }),

                    //extent: [590000, 210000, 645000, 262000],
                    style: 'default'
                })
            });
            
            var layerVectors = new ol.layer.Image({
                source: new ol.source.ImageWMS({
                    url: 'http://www.catais.org/wms/lokale_entzerrung',
                    params: {'LAYERS': 'Vektoren Mittel,Vektoren GP, Vektoren LFP,Weitere Kontrollmessungen'},
                    //serverType: 'geoserver',
                    //extent: [-13884991, 2870341, -7455066, 6338219]
                })
            });
            
            var map = new ol.Map({
                renderer: 'canvas',
                //renderer: 'dom',
                controls: ol.control.defaults().extend([
                    new ol.control.FullScreen(), 
                    new ol.control.ScaleLine({
                        units: 'metric'
                    })
                ]),
                ol3Logo: false,
                target: 'map',
                layers: [
                    layerGrayMap,                    
                    layerColorMap,
                    layerOrtho,
                    layerVectors
                ],  
                view: new ol.View2D({
                    projection: projection,
                    center: [607446, 228854],
                    zoom: 21,
                    resolutions: [4000,3750,3500,3250,3000,2750,2500,2250,2000,1750,1500,1250,1000,750,650,500,250,100,50,20,10,5,2.5,2,1.5,1,0.5,0.25,0.1,0.05]
                })
            });
            
            // 'baselayer/exclusive' o.ä. bei den Layern noch einführen
            // sonst nicht unterscheidbar. andere methode?
            map.getLayers().getArray().forEach(function(layer){
//                console.log(layer.get("layerName"));
                var bgLayerName = layer.get("layerName");
                var bgLayerId = layer.get("layerId");
                var isBaseLayer = layer.get("baselayer");
                if (isBaseLayer) {
                    $('#layer-select').append('<option value=' + bgLayerId + '>' + bgLayerName + '</option>'); 
                }
            });
            
//            console.log("1");
//            $('#layer-select option').each(function()                        
//            {
//                console.log($(this).val());
//                bgLayerNames.push($(this).val());
//            });
//            console.log(bgLayerNames);

            $('#layer-select').change(function() {
                var selectedBgLayerId = $(this).find(':selected').val();
//                console.log(selectedBgLayerId);
                map.getLayers().getArray().forEach(function(layer){
                    var isBaseLayer = layer.get("baselayer");
                    if (isBaseLayer) {
                        if (selectedBgLayerId == layer.get("layerId")) {
                            layer.setVisible(true);
                        } else {
                            layer.setVisible(false);
                        }
                    }
                });
            });
            $('#layer-select').trigger('change');     
            
        </script>
    </body>
</html>